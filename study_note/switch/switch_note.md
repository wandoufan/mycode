# 交换机

## 交换机的概念
交换机是一种基于MAC（网卡的硬件地址）识别，能完成封装转发数据包功能的网络设备  
用交换机组成的网络称为交换式网络，提供给每个用户专用的信息通道  
一般多个端口之间可以同时通信而不发生冲突，除非多个源端口同时向一个目的端口发数据  
交换机工作在第6层-数据链路层  


## 交换机的工作过程
交换机可以学习并记录网络中所有设备的MAC地址，并把地址存放在内部的地址表中  
通过在数据帧的始发者和目标接收者之间建立临时的交换路径，使数据帧直接由源地址到达目的地址，即点到点的数据转发  
交换机接收到一个帧之后，先判断MAC地址表中是否有记录：  
如果有，就把数据帧直接转发给目标端口(即单播)  
如果没有，就把数据帧从非接收接口发送出去(即组播)  
交换机之间会相互学习地址表？？？


## 集线器(Hub)的概念
集线器是工作在第7层-物理层的硬件设备  
集线器实际上是中继器的一种，但集线器能够提供多个端口，也称为多口中继器  
用集线器组成的网络称为共享式网络，用户共享带宽，网络繁忙时可能会拥堵  


## 路由器的概念


## 工作模式
半双工模式
全双工模式


## 数据帧的分类
1. 广播帧：传输到本网段上每个节点的数据帧，其中网段是由广播域定义的
广播数据是网络中必不可少的，例如ARP、DHCP、RIP都是广播帧的形式  
但广播数据太多，则会造成网络拥堵  
2. 单播帧：点到点传播的数据帧


## 交换机参数
端口数
速度



## 网络不稳定/中断的常见原因
1. 网络风暴/广播风暴
2. 网络线路老化等故障
3. 网络流量超过了网络带宽的上限


## 网络风暴/广播风暴
**基本概念**
由于网络拓扑的设计和连接问题，或其他原因导致广播在网段内大量复制，传播数据帧，导致网络性能下降，甚至网络瘫痪  
**常见原因**
1. 用集线器来作为交换机使用
2. 网络设备的网卡损坏
损坏的的网卡可能会不停的向交换机发送大量的无效数据包  
3. 网络环路
例如，将同一根网线的两端插在一台交换机的不同端口上，在网络拓扑中形成了网络环路  
在网络环路中，数据包会循环的进行传输，最终造成网络拥堵  
4. ARP病毒等网络攻击
5. 网络划分不合理，太多用户挤在同一个网段


## ARP
1. ARP协议
ARP（Address Resolution Protocol），即地址解析协议  
ARP是根据IP地址获取物理地址的一个TCP/IP协议，工作在第5层-网络层  
在TCP/IP的协议栈中，ARP协议属于非常不安全的一种协议  
2. 工作过程
主机发送信息时将包含目标IP地址的ARP请求广播到局域网络上的所有主机，并接收返回消息，以此确定目标的物理地址  
收到返回消息后将该IP地址和物理地址存入本机ARP缓存中并保留一定时间，下次请求时直接查询ARP缓存中的物理地址以节约资源  
ARP命令可用于查询本机ARP缓存中IP地址和MAC地址的对应关系、添加或删除静态对应关系等  
3. ARP欺骗
APR协议是建立在网络中各个主机相互信任的基础上，即主机接收到应答报文时不会验证其真假就直接将地址存入本机的ARP缓存中  
如果网络中存在攻击者向某一主机发送伪ARP应答报文，使其发送的信息无法到达预期的主机或到达错误的主机，这就构成了一个ARP欺骗  
4. ARP病毒
ARP病毒并不是某一种病毒的名称，而是对利用ARP协议的漏洞进行传播的一类病毒的总称  
通常此类攻击的手段有两种：路由欺骗和网关欺骗  
若感染ARP病毒，可以通过清空ARP缓存、指定ARP对应关系、添加路由信息、使用防病毒软件等方式解决  
5. ARP防火墙
ARP防火墙通过在系统内核层拦截虚假ARP数据包以及主动通告网关本机正确的MAC地址，可以保障数据流向正确，不经过第三者  


## 二层交换机


## 三层交换机
第三层交换技术也称为ip交换技术、高速路由技术等
第三层交换技术是在网络模型中的第三层实现了数据包的高速转发
简单地说，第三层交换技术就是：第二层交换技术＋第三层转发技术。这是一种利用第三层协议中的信息来加强第二层交换功能的机制
一个具有第三层交换功能的设备是一个带有第三层路由功能的第二层交换机
在第三层交换机中，与路由器有关的第三层路由硬件模块也插接在高速背板/总线上，这种方式使得路由模块可以与需要路由的其他模块间高速的交换数据



## 一些概念
洪范式广播学习
二层交换机，三层交换机
核心交换机-楼层交换机
地址表中的每个MAC对应交换机的一个端口？

## 整体网络架构


## 交换机的管理方式
1. 带外管理
通过直接连接交换机的console口管理交换机属于带外管理，不占用交换机的网络接口  
第一次配置交换机是必须利用console端口进行配置  
另外，当出现网络故障时带内管理可能会失效，此时必须使用带外管理  
2. 带内管理
带内管理是指管理控制信息与数据业务信息通过同一个信道传送，管理控制信息会占用业务带宽  
带内管理就是通过网络来管理交换机，如Telnet、SSH、Web等方式  
日常管理一般都使用带内管理，常用工具有Putty、SecureCRT、Xshell等  


## console口
console口和普通的以太网口一样，在交换机上会有文字标注，用来对交换机进行直连配置  
console线一端是网线水晶头，另一端是9针或25针的串行接口(电脑上如果没有对应接口则需要转换器)  


## Trunk口
trunk口不是一个物理上的接口，而是交换机上接口的类型之一，可以通过交换机命令进行设置  
trunk端口可以属于多个vlan，可以跨vlan进行通信，多用于交换机之间  


## 端口含义
1. 端口描述
Ethernet 以太网端口，10Mbit/s  
FastEthernet 快速以太网端口，100Mbit/s  
GigabitEthernet 千兆以太网端口，1000Mbit/s  
2. 端口编号规则
Ethernet1/2/3表示的就是：第1板卡的2槽位的3端口  


## 端口类型
1. Access类型
端口只能属于一个vlan，一般用于连接计算机  
2. Trunk类型
端口可以属于多个vlan，可以跨vlan进行通信，多用于交换机之间  
3. Hybrid类型
端口可以属于多个vlan，可以跨vlan进行通信，可以用于交换机之间，也可以用于连接用户主机  
注意事项：
1. Trunk端口和Hybrid端口之间不能直接切换，只能先设为Access端口，再设置为Hybrid端口  
2. 同一个交换机上Trunk端口和Hybrid端口不能并存  