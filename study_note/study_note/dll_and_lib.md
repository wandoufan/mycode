# DLL(dynamic link library)动态链接库

## 基本概念
DLL是一个包含有代码和数据，且可以被多个程序或其他DLL调用的库，一般用在windows系统中  
DLL中常存放一些经常变动的参数和数据，程序可以不改变自身，而是通过调用DLL来实现更新  
例如，在税率计算程序中，税率参数会经常变动，将税率放入DLL中，无需重新安装整个程序就可以实现应用更新  

## DLL的优点
通过使用DLL，程序可以实现模块化，模块只有被用到时才加载，减少内存占用，因此程序速度可以更快  
另外，当DLL更新后，不要求重新建立程序与该DLL之间的链接，程序更新更加便捷  

## 动态库与静态库(static link library)
计算机中的库文件包括动态库和静态库，发展历程为：无库->静态库->动态库  
静态库在程序的链接阶段被复制到了程序中，库中指令都被直接包含在最终生成的可以执行文件中了  
动态库在需要时才被加载到内存中供程序调用，最终生成的可执行文件中不必包含动态库  
在Liunx/Unix系统中静态库文件后缀为.a，动态库文件后缀为.so  
在windows系统中静态库文件后缀为.lib，动态库文件后缀为.dll  

## 显式链接和隐式链接
动态链接库包含显式链接和隐式链接两种使用方式  
显式链接(explicit linking)在程序执行到某个函数时才去加载对应的动态库，程序在运行前并不检查这些动态库是否存在  
隐式链接(implicit linking)在程序运行前，操作系统就会检查其依赖的动态库（如果缺少动态库程序就直接报错），并将动态库都加载到内存中，属于最常用的方式  

## Windows系统中作为DLL实现的文件
1. ActiveX 控件 (.ocx) 文件  
ActiveX 控件的一个示例是日历控件，它使您可以从日历中选择日期  
2. 控制面板 (.cpl) 文件  
.cpl 文件的一个示例是位于控制面板中的项，每个项都是一个专用DLL  
3. 设备驱动程序 (.drv) 文件  
设备驱动程序的一个示例是控制打印到打印机的打印机驱动程序  

## DLL依赖项
当某个程序需要调用DLL时就会创建依赖项，该程序就不再是独立的，且当该依赖项被损坏时，该程序就可能出问题  
常见的DLL冲突包括：  
依赖DLL升级到了新版本  
修复了依赖DLL  
依赖DLL被其早期版本覆盖  
从计算机中删除了依赖DLL  

## DLL故障排除工具
Dependency Walker工具可以递归扫描以寻找程序所使用的所有依赖DLL，并检查DLL是否丢失或损坏  

## 常见DLL文件
Windows系统提供了大量的DLL文件作为API接口：
1. USER32.DLL  
与windows管理有关的函数，消息、菜单、光标、计时器、通信和其他大多数非现实函数都可以从这里找到  
2. GDI32.DLL  
图形设备接口库，与设备输出有关的函数：大多数绘图、显示场景、图元文件、坐标及其字体函数都可以从这里找到  
3. COMDLG32.DLL\LZ32.DLL\VERSION.DLL  
这都是提供一些附加函数的库，包括通用对话框、文件压缩、版本控制的支持  
4. COMCTL32.DLL  
一个新的windows控件集合，比如TreeView和RichTextBox等等，最初这个是为了win95而制作的，但是现在也使用于NT中  
5. MAPI32.DLL  
提供了一套电子邮件的专用函数  
6. NETAPI32.DLL  
提供了一套访问和控制网络的函数  
7. ODBC32.DLL  
ODBC功能的DLL之一  
8. WINMM.DLL  
是多媒体控制访问函数集合  

